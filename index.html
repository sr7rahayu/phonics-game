<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Phonics Game üéµ</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700&display=swap" rel="stylesheet">
<style>
  :root{ --bg1:#667eea; --bg2:#764ba2; --card:#fff; --ink:#111827; --shadow:0 12px 28px rgba(0,0,0,.18) }
  *{ box-sizing:border-box }
  body{
    margin:0; min-height:100vh; padding:20px; text-align:center; color:#fff;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    font-family:'Nunito',system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }
  h1{ margin:0 0 8px; text-shadow:0 6px 16px rgba(0,0,0,.25) }
  .sub{ margin:0 0 14px; opacity:.95 }
  .panel{ background:var(--card); color:var(--ink); border-radius:22px; padding:20px; max-width:980px; margin:14px auto; box-shadow:var(--shadow) }

  /* Smaller, responsive grid so all letters fit on phones */
  .grid {
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
    max-width: 500px;
    margin: 10px auto 16px;
  }

  .btn{
    border:none; border-radius:12px; color:#fff; font-weight:900; cursor:pointer;
    aspect-ratio:1/1; font-size:clamp(14px, 4vw, 18px);
    box-shadow:var(--shadow);
    transition:transform .08s ease, filter .2s ease;
    background:linear-gradient(135deg,#ff6b6b,#ee5a24);
  }
  .btn:nth-child(5n+2){ background:linear-gradient(135deg,#4ecdc4,#44a08d) }
  .btn:nth-child(5n+3){ background:linear-gradient(135deg,#a78bfa,#60a5fa) }
  .btn:nth-child(5n+4){ background:linear-gradient(135deg,#f59e0b,#ef4444) }
  .btn:nth-child(5n+5){ background:linear-gradient(135deg,#06b6d4,#10b981) }
  .btn:active{ transform:translateY(1px) scale(.98); filter:brightness(.95) }

  .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:8px 0 6px }
  .ctl{ background:#111827; color:#fff; border:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.18) }
  .ctl[disabled]{ opacity:.5; cursor:not-allowed }
  .status{ margin:10px auto; font-weight:900 }
</style>
</head>
<body>
  <h1>Phonics Game üéµ</h1>
  <p class="sub">Tap letters to overlap ‚Ä¢ A‚ÜíZ starts each next letter at half of the previous letter‚Äôs duration</p>

  <div class="panel">
    <div id="grid" class="grid"></div>

    <div class="controls">
      <button id="stopAll" class="ctl">‚èπ Stop All</button>
      <button id="playAZ" class="ctl">üîÅ Play A ‚Üí Z</button>
    </div>

    <div id="status" class="status">Now Playing: (none)</div>
  </div>

<script>
  // Google Drive fallback (if local A.mp3‚Ä¶Z.mp3 is missing)
  const gdl = id => `https://drive.googleusercontent.com/uc?id=${id}&export=download`;
  const DRIVE = {
    A:"1Qe1aCr14oUrDU-6EMcxzeAyMU8NMXfae", B:"10IJYuYVMFQJGHycrLFCX6zG4yz41qmWJ",
    C:"15R8QN67z2I2fQajmObMkBWkobcpczK2M", D:"1jUcdWAYesbmdOkfs-0sSsAJ9WEjBM3NI",
    E:"12YSf9qsSJru0tAtsGBeYiYt2gQ0Dztgr", F:"1oqmBDnCIeXiZvfJYnSgg3kZP9Iw6qyFM",
    G:"1hnhna5SXk7qCMP4Z_eV1I5b5fLLW4TXv", H:"1OY8rgUAilYGOD0yjZ9mD16TzoelEsPrC",
    I:"1vXiQpBw4Q-kPp0uvtydnC7KS6fQvew4D", J:"194ZXxUJISwq5vkB94SZ_gJ_annsgVxy3",
    K:"12z_yfJUmhkd5LN1poMN2dNgXO1yyCSEA", L:"1HHPYFY4p-Z__6SZKEKgSOCBug4gsIGC1",
    M:"1zuOsAkuCo4bRV9LGl-ElNNjA2y5bTJa7", N:"1PiG51Z1neVqxVGvWxotHwhUd3-Ljb5Jy",
    O:"11ymp4cEflp3FIzJN3XYdalDdv8lqJLkX", P:"1YiqPEjT5C4gY8M7B6w3ykf8r4GdQQeeH",
    Q:"1ZOGnULcvvf8aNTWeZdjCB93xmcFnZVPb", R:"1QleiMuwxKQnlF4vfciQFxpLwEq7oV4zO",
    S:"1XBvC4nse_amvfLiLBReiEpDHcAfJ7Z1T", T:"1lPK7U4XqhbCY2eV9eNnHKmWyWMGljm3k",
    U:"13_Z4QA5fP6KzU0myieJD1ZG2IMU_aU6i", V:"1EKd7dITWTuEwIlVOQ_dq1Fy3BIfVJ6zA",
    W:"1Bh8Wx6tXfbwA1_KW4tHaMKd3Vmc2MQ3y", X:"1NqCJc7LGjdnGMDPnkmHY3qZx-PphRuxw",
    Y:"1GKyvE5x-aR_mlwXLBwDGEpGowwjR_Nnd", Z:"1K4J-Lu0zWHjk6ciMVxw_JuPiOrIuXXmZ"
  };

  const grid   = document.getElementById('grid');
  const stopBtn= document.getElementById('stopAll');
  const playAZ = document.getElementById('playAZ');
  const status = document.getElementById('status');

  // Track active (for Now Playing + Stop All)
  const active = new Map(); // Map<HTMLAudioElement, letter>
  let sequenceAbort = false; // lets Stop All abort the A‚ÜíZ sequence

  // Build letter buttons
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(L => {
    const b = document.createElement('button');
    b.className = 'btn'; b.textContent = L;
    b.addEventListener('click', () => playOverlap(L)); // taps can overlap
    grid.appendChild(b);
  });

  const localUrl = L => `${L}.mp3?ts=${Date.now()}`;
  const driveUrl = L => `${gdl(DRIVE[L])}&v=${Date.now()}`;

  // Tap behavior: play immediately (overlap allowed)
  async function playOverlap(L){
    let a = new Audio(localUrl(L));
    try { await a.play(); attach(L, a); }
    catch {
      a = new Audio(driveUrl(L));
      try { await a.play(); attach(L, a); } catch {}
    }
  }

  // --- A‚ÜíZ button: half-overlap sequencing ---
  playAZ.addEventListener('click', async () => {
    playAZ.disabled = true;
    sequenceAbort = false;
    // play A‚Ä¶Z; schedule next after half of current clip‚Äôs real duration
    for (const L of "ABCDEFGHIJKLMNOPQRSTUVWXYZ") {
      if (sequenceAbort) break;
      await playNextAtHalf(L);
      if (sequenceAbort) break;
    }
    playAZ.disabled = false;
  });

  // Returns when it's time to start the NEXT letter (after half duration)
  function playNextAtHalf(L){
    return new Promise(async (resolve) => {
      // Try local first, then Drive
      let a = new Audio(localUrl(L));
      const cleanupAndResolve = () => { active.delete(a); updateStatus(); /* allow current to keep playing; nothing more to do here */ };
      a.addEventListener('ended', cleanupAndResolve, {once:true});

      // Helper to start and then resolve after half duration (or fallback)
      const startWith = async (audio) => {
        try {
          await audio.play();
          attach(L, audio, /*skipEndHook=*/true); // we attached a custom 'ended' above
          updateStatus();

          const halfMs = await halfDurationMs(audio);
          // After half of this clip, resolve so the loop can start the next letter.
          setTimeout(() => resolve(), halfMs);
        } catch {
          // If couldn't play at all, resolve immediately so the sequence continues
          resolve();
        }
      };

      try {
        await startWith(a);
      } catch {
        a.removeEventListener('ended', cleanupAndResolve);
        a = new Audio(driveUrl(L));
        a.addEventListener('ended', cleanupAndResolve, {once:true});
        await startWith(a);
      }
    });
  }

  // Compute half the true duration (ms); wait for metadata if needed; fallback if unknown
  function halfDurationMs(audio){
    return new Promise((res) => {
      const fallback = 800; // default if duration can't be known
      const finish = () => {
        const d = audio.duration;
        if (Number.isFinite(d) && d > 0) {
          res(Math.max(200, (d * 1000) / 2)); // at least 200ms
        } else {
          res(fallback);
        }
      };

      if (Number.isFinite(audio.duration) && audio.duration > 0) {
        finish();
      } else {
        const onMeta = () => { cleanup(); finish(); };
        const onTimeout = () => { cleanup(); res(fallback); };
        const cleanup = () => {
          audio.removeEventListener('loadedmetadata', onMeta);
          audio.removeEventListener('durationchange', onMeta);
        };
        audio.addEventListener('loadedmetadata', onMeta, {once:true});
        audio.addEventListener('durationchange', onMeta, {once:true});
        // If metadata never arrives quickly, fallback
        setTimeout(onTimeout, 1200);
      }
    });
  }

  // Attach an audio to tracking; optionally skip wiring default 'ended' hook
  function attach(L, audio, skipEndHook=false){
    active.set(audio, L);
    if (!skipEndHook) {
      audio.addEventListener('ended', () => { active.delete(audio); updateStatus(); }, {once:true});
    }
    // also remove if stopped immediately
    audio.addEventListener('pause', () => {
      if (audio.currentTime === 0) { active.delete(audio); updateStatus(); }
    });
    updateStatus();
  }

  // Stop All cancels everything and also aborts A‚ÜíZ sequence
  stopBtn.addEventListener('click', () => {
    sequenceAbort = true;
    for (const audio of Array.from(active.keys())) {
      try { audio.pause(); audio.currentTime = 0; } catch(e){}
      try { audio.removeAttribute('src'); audio.load(); } catch(e){}
      active.delete(audio);
    }
    updateStatus();
  });

  function updateStatus(){
    if (active.size === 0) {
      status.textContent = 'Now Playing: (none)';
    } else {
      // show in the order they started (Map preserves insertion order)
      const letters = Array.from(active.values());
      status.textContent = 'Now Playing: ' + letters.join(', ');
    }
  }
</script>
</body>
</html>
