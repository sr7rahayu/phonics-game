<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phonics Game üéµ</title>
  <style>
    :root{
      --bg1:#667eea; --bg2:#764ba2; --card:#ffffff; --ink:#1f2937;
      --shadow:0 12px 28px rgba(0,0,0,.18);
    }
    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Nunito", sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: #fff; margin:0; min-height:100vh; padding:20px; text-align:center;
    }
    h1{ margin:0 0 6px; text-shadow:0 6px 16px rgba(0,0,0,.25) }
    p.sub{ margin:0 0 16px; opacity:.95 }
    .panel{
      background:var(--card); color:var(--ink);
      border-radius:22px; padding:20px; box-shadow:var(--shadow);
      max-width:980px; margin:14px auto;
    }
    .grid{
      display:grid; gap:12px; max-width:700px; margin:16px auto 8px;
      grid-template-columns: repeat(auto-fit, minmax(72px, 1fr));
    }
    .btn{
      border:none; border-radius:16px; color:#fff; font-weight:800; cursor:pointer;
      padding:16px 0; font-size:20px; aspect-ratio:1/1; box-shadow:var(--shadow);
      background: linear-gradient(135deg,#ff6b6b,#ee5a24);
      transition: transform .08s ease, filter .2s ease;
    }
    .btn:nth-child(5n+2){ background:linear-gradient(135deg,#4ecdc4,#44a08d)}
    .btn:nth-child(5n+3){ background:linear-gradient(135deg,#a78bfa,#60a5fa)}
    .btn:nth-child(5n+4){ background:linear-gradient(135deg,#f59e0b,#ef4444)}
    .btn:nth-child(5n+5){ background:linear-gradient(135deg,#06b6d4,#10b981)}
    .btn:active{ transform: translateY(1px) scale(.98); filter:brightness(.95) }

    .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:12px auto 6px }
    .ctl{
      background:#111827; color:#fff; border:none; border-radius:12px;
      padding:10px 14px; font-weight:800; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.18);
    }
    .wordbox{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center;
      background:#f3f4f6; padding:8px 10px; border-radius:14px;
    }
    input{
      border:none; outline:none; background:#fff; color:#111;
      border-radius:10px; padding:10px 12px; min-width:200px; font-weight:700;
    }

    .status{
      margin:10px auto 4px; font-weight:800;
      max-width:760px; text-align:center;
    }

    /* Now Playing list */
    .np-wrap{ max-width:760px; margin:10px auto 0; text-align:left }
    .np-title{ margin:0 0 8px; font-weight:900 }
    .np-list{ list-style:none; padding:0; margin:0; display:flex; flex-wrap:wrap; gap:8px }
    .chip{
      background:#eef2ff; color:#3730a3; border-radius:999px; padding:6px 10px;
      font-weight:800; display:flex; align-items:center; gap:6px; box-shadow:0 2px 8px rgba(0,0,0,.08)
    }
    .chip small{ color:#6b7280; font-weight:700 }
    .foot{ opacity:.85; font-size:12px; margin-top:8px; text-align:center }
    .debug{ font-size:12px; color:#6b7280; margin-top:6px }
  </style>
</head>
<body>
  <h1>Phonics Game üéµ</h1>
  <p class="sub">Tap letters to overlap sounds ‚Ä¢ Type a word to play all letters together</p>

  <div class="panel">
    <div id="alphabet" class="grid"></div>

    <div class="controls">
      <button id="stopAll" class="ctl">‚èπ Stop All</button>
      <div class="wordbox">
        <input id="wordInput" placeholder="Type a word (e.g., CAT)" />
        <button id="playWord" class="ctl">‚úçÔ∏è Write the Word</button>
      </div>
    </div>

    <div id="status" class="status">Ready ‚úÖ</div>
    <div id="debug" class="debug"></div>

    <div class="np-wrap">
      <p class="np-title">Now Playing:</p>
      <ul id="np" class="np-list"></ul>
      <div class="foot">If anything doesn‚Äôt play, ensure each Google Drive file is shared as ‚ÄúAnyone with the link‚Äù.</div>
    </div>
  </div>

  <script>
    // 1) Google Drive links (fallback):
    const DRIVE = {
      A:"https://drive.google.com/uc?export=download&id=1Qe1aCr14oUrDU-6EMcxzeAyMU8NMXfae",
      B:"https://drive.google.com/uc?export=download&id=10IJYuYVMFQJGHycrLFCX6zG4yz41qmWJ",
      C:"https://drive.google.com/uc?export=download&id=15R8QN67z2I2fQajmObMkBWkobcpczK2M",
      D:"https://drive.google.com/uc?export=download&id=1jUcdWAYesbmdOkfs-0sSsAJ9WEjBM3NI",
      E:"https://drive.google.com/uc?export=download&id=12YSf9qsSJru0tAtsGBeYiYt2gQ0Dztgr",
      F:"https://drive.google.com/uc?export=download&id=1oqmBDnCIeXiZvfJYnSgg3kZP9Iw6qyFM",
      G:"https://drive.google.com/uc?export=download&id=1hnhna5SXk7qCMP4Z_eV1I5b5fLLW4TXv",
      H:"https://drive.google.com/uc?export=download&id=1OY8rgUAilYGOD0yjZ9mD16TzoelEsPrC",
      I:"https://drive.google.com/uc?export=download&id=1vXiQpBw4Q-kPp0uvtydnC7KS6fQvew4D",
      J:"https://drive.google.com/uc?export=download&id=194ZXxUJISwq5vkB94SZ_gJ_annsgVxy3",
      K:"https://drive.google.com/uc?export=download&id=12z_yfJUmhkd5LN1poMN2dNgXO1yyCSEA",
      L:"https://drive.google.com/uc?export=download&id=1HHPYFY4p-Z__6SZKEKgSOCBug4gsIGC1",
      M:"https://drive.google.com/uc?export=download&id=1zuOsAkuCo4bRV9LGl-ElNNjA2y5bTJa7",
      N:"https://drive.google.com/uc?export=download&id=1PiG51Z1neVqxVGvWxotHwhUd3-Ljb5Jy",
      O:"https://drive.google.com/uc?export=download&id=11ymp4cEflp3FIzJN3XYdalDdv8lqJLkX",
      P:"https://drive.google.com/uc?export=download&id=1YiqPEjT5C4gY8M7B6w3ykf8r4GdQQeeH",
      Q:"https://drive.google.com/uc?export=download&id=1ZOGnULcvvf8aNTWeZdjCB93xmcFnZVPb",
      R:"https://drive.google.com/uc?export=download&id=1QleiMuwxKQnlF4vfciQFxpLwEq7oV4zO",
      S:"https://drive.google.com/uc?export=download&id=1XBvC4nse_amvfLiLBReiEpDHcAfJ7Z1T",
      T:"https://drive.google.com/uc?export=download&id=1lPK7U4XqhbCY2eV9eNnHKmWyWMGljm3k",
      U:"https://drive.google.com/uc?export=download&id=13_Z4QA5fP6KzU0myieJD1ZG2IMU_aU6i",
      V:"https://drive.google.com/uc?export=download&id=1EKd7dITWTuEwIlVOQ_dq1Fy3BIfVJ6zA",
      W:"https://drive.google.com/uc?export=download&id=1Bh8Wx6tXfbwA1_KW4tHaMKd3Vmc2MQ3y",
      X:"https://drive.google.com/uc?export=download&id=1NqCJc7LGjdnGMDPnkmHY3qZx-PphRuxw",
      Y:"https://drive.google.com/uc?export=download&id=1GKyvE5x-aR_mlwXLBwDGEpGowwjR_Nnd",
      Z:"https://drive.google.com/uc?export=download&id=1K4J-Lu0zWHjk6ciMVxw_JuPiOrIuXXmZ"
    };

    const grid  = document.getElementById('alphabet');
    const statusEl = document.getElementById('status');
    const debugEl  = document.getElementById('debug');
    const npList   = document.getElementById('np');
    const active   = new Set(); // Set<HTMLAudioElement>
    const chips    = new Map(); // Map<HTMLAudioElement, HTMLLIElement>

    // Build A‚ÄìZ buttons
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(L => {
      const b = document.createElement('button');
      b.className = 'btn';
      b.textContent = L;
      b.onclick = () => playLetter(L);
      grid.appendChild(b);
    });

    // Candidate sources: local first, then Drive with cache-buster
    function candidateURLs(letter){
      const drive = DRIVE[letter] ? DRIVE[letter] + (DRIVE[letter].includes('?')?'&':'?') + 'v=' + Date.now() : null;
      return [
        `${letter}.mp3`,                // repo root (recommended)
        `./${letter}.mp3`,              // explicit relative
        drive                           // fallback to Drive
      ].filter(Boolean);
    }

    // Try to start an <audio> from the list of candidate URLs
    async function startAudio(letter){
      const urls = candidateURLs(letter);
      for (let i=0; i<urls.length; i++){
        const url = urls[i];
        const a = new Audio(url);
        a.preload = 'auto';
        a.crossOrigin = 'anonymous';
        attachNowPlaying(letter, a, url);
        try {
          await a.play();
          log(`‚ñ∂Ô∏è ${letter}: playing ${url}`);
          return a; // success
        } catch (err){
          // remove chip for this failed try
          detachNowPlaying(a);
          log(`‚ö†Ô∏è ${letter}: failed ${url}`);
          // try next candidate
        }
      }
      throw new Error(`No playable source for ${letter}`);
    }

    function log(msg){
      debugEl.textContent = msg;
    }

    function attachNowPlaying(letter, audio, urlShown){
      active.add(audio);
      const li = document.createElement('li');
      li.className = 'chip';
      li.innerHTML = `<strong>${letter}</strong> <small>${new Date().toLocaleTimeString()}</small>`;
      li.title = urlShown;
      npList.prepend(li);
      chips.set(audio, li);
      audio.onended = () => detachNowPlaying(audio);
      audio.onpause = () => { if (audio.currentTime === 0) detachNowPlaying(audio); };
    }

    function detachNowPlaying(audio){
      active.delete(audio);
      const li = chips.get(audio);
      if (li){ li.remove(); chips.delete(audio); }
    }

    async function playLetter(letter){
      statusEl.textContent = `Loading ${letter}‚Ä¶`;
      try {
        const a = await startAudio(letter);
        statusEl.textContent = `üîä Playing ${letter}`;
      } catch {
        statusEl.textContent = `‚ùó Could not play ${letter}`;
      }
    }

    // Stop All
    document.getElementById('stopAll').onclick = () => {
      for (const a of Array.from(active)) {
        try { a.pause(); a.currentTime = 0; } catch(e){}
        try { a.removeAttribute('src'); a.load(); } catch(e){}
        detachNowPlaying(a);
      }
      statusEl.textContent = "‚èπ All stopped";
      log('');
    };

    // Write the Word: play ALL letters together
    document.getElementById('playWord').onclick = async () => {
      const raw = (document.getElementById('wordInput').value || '').toUpperCase();
      const letters = [...raw].filter(c => /[A-Z]/.test(c));
      if (letters.length === 0){
        statusEl.textContent = "‚ùå Type A‚ÄìZ letters";
        return;
      }
      statusEl.textContent = `‚úçÔ∏è Playing: ${raw}`;

      // Start all letters concurrently (overlap). Each letter tries local then Drive.
      await Promise.allSettled(
        letters.map(async (L, i) => {
          // slight 10ms stagger to help mobile decoders
          await new Promise(r => setTimeout(r, i*10));
          try { await startAudio(L); } catch {}
        })
      );
    };
  </script>
</body>
</html>
