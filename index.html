<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Alphabet Phonics ‚Äî Overlap + Sequencer</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700&family=Nunito:wght@600;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg1:#667eea; --bg2:#764ba2; --ink:#1f2937; --card:#fff; --shadow:0 12px 28px rgba(0,0,0,.18); }
  *{ box-sizing:border-box }
  body{
    margin:0; min-height:100vh; padding:18px;
    font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%); color:#fff; text-align:center;
  }
  h1{
    font-family:'Fredoka', cursive; font-weight:700;
    font-size:clamp(1.8rem, 4.5vw, 3rem);
    margin:2px 0 6px; text-shadow:0 6px 16px rgba(0,0,0,.25);
  }
  .subtitle{ opacity:.95; margin-bottom:12px }
  .wrap{ max-width:1100px; margin:0 auto }
  .panel{ background:var(--card); color:var(--ink); border-radius:22px; padding:20px; box-shadow:var(--shadow); max-width:980px; margin:14px auto; }
  .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; align-items:center; margin:6px 0 14px; }
  .btn-ctl{
    background:#111827; color:#fff; border:none; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
    box-shadow:0 6px 16px rgba(0,0,0,.18);
  }
  .btn-ctl.secondary{ background:#4b5563; }
  .word-box{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; align-items:center; background:#f9fafb; border-radius:14px; padding:8px 10px; }
  .word-box input{
    border:none; outline:none; border-radius:10px; padding:10px 12px; min-width:180px; font-size:1rem; font-weight:700;
    background:#fff; color:#111;
  }
  .grid{ display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(72px, 1fr)); max-width:900px; margin:10px auto 18px; }
  .btn{
    aspect-ratio:1/1; border:none; border-radius:18px; color:#fff; cursor:pointer; font-weight:800;
    font-family:'Fredoka', cursive; font-size:clamp(1.4rem,4.5vw,2.2rem);
    box-shadow:var(--shadow); transition:transform .08s ease, filter .2s ease; position:relative; overflow:hidden;
  }
  .btn:nth-child(5n+1){ background:linear-gradient(135deg,#ff6b6b,#ee5a24); }
  .btn:nth-child(5n+2){ background:linear-gradient(135deg,#4ecdc4,#44a08d); }
  .btn:nth-child(5n+3){ background:linear-gradient(135deg,#a78bfa,#60a5fa); }
  .btn:nth-child(5n+4){ background:linear-gradient(135deg,#f59e0b,#ef4444); }
  .btn:nth-child(5n+5){ background:linear-gradient(135deg,#06b6d4,#10b981); }
  .btn:active{ transform: translateY(1px) scale(.98); filter:brightness(.95); }
  .btn.flash::after{ content:""; position:absolute; inset:0; border-radius:inherit; box-shadow:0 0 0 4px rgba(255,255,255,.6) inset; animation:flash .22s ease; }
  @keyframes flash{ from{opacity:1} to{opacity:0} }

  .now-playing{ text-align:left; margin:0 auto; max-width:760px; }
  .np-title{ font-weight:800; margin:0 0 8px; }
  .np-list{ display:flex; flex-wrap:wrap; gap:8px; list-style:none; padding:0; margin:0; }
  .np-chip{
    background:#eef2ff; color:#3730a3; border-radius:999px; padding:6px 10px; font-weight:800; min-width:36px; text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,.08); display:flex; align-items:center; gap:6px;
  }
  .np-chip small{ color:#6b7280; font-weight:700 }
  .status{ margin-top:10px; font-weight:800 }
  .warn{ color:#b91c1c } .ok{ color:#16a34a }
</style>
</head>
<body>
  <div class="wrap">
    <h1>üéµ Alphabet Phonics ‚Äî Overlap + Sequencer</h1>
    <div class="subtitle">Tap letters to overlap sounds ‚Ä¢ Play A‚ÜíZ ‚Ä¢ Type a word and play all letters together</div>

    <div class="panel">
      <div class="controls">
        <button id="stopAll" class="btn-ctl">‚èπÔ∏è Stop All</button>
        <button id="playAZ" class="btn-ctl secondary">üîÅ Play A ‚Üí Z</button>
        <div class="word-box">
          <input id="wordInput" type="text" placeholder="Type a word (e.g., CAT)"/>
          <button id="playWord" class="btn-ctl">‚úçÔ∏è Write the Word</button>
        </div>
      </div>

      <div id="grid" class="grid"></div>

      <div class="now-playing">
        <p class="np-title">Now Playing (latest first):</p>
        <ul id="np" class="np-list"></ul>
        <p id="status" class="status">Ready. Tap a letter to play.</p>
      </div>
    </div>
  </div>

<script>
  // === Google Drive direct links ===
  const DRIVE = {
    A:"https://drive.google.com/uc?export=download&id=1Qe1aCr14oUrDU-6EMcxzeAyMU8NMXfae",
    B:"https://drive.google.com/uc?export=download&id=10IJYuYVMFQJGHycrLFCX6zG4yz41qmWJ",
    C:"https://drive.google.com/uc?export=download&id=15R8QN67z2I2fQajmObMkBWkobcpczK2M",
    D:"https://drive.google.com/uc?export=download&id=1jUcdWAYesbmdOkfs-0sSsAJ9WEjBM3NI",
    E:"https://drive.google.com/uc?export=download&id=12YSf9qsSJru0tAtsGBeYiYt2gQ0Dztgr",
    F:"https://drive.google.com/uc?export=download&id=1oqmBDnCIeXiZvfJYnSgg3kZP9Iw6qyFM",
    G:"https://drive.google.com/uc?export=download&id=1hnhna5SXk7qCMP4Z_eV1I5b5fLLW4TXv",
    H:"https://drive.google.com/uc?export=download&id=1OY8rgUAilYGOD0yjZ9mD16TzoelEsPrC",
    I:"https://drive.google.com/uc?export=download&id=1vXiQpBw4Q-kPp0uvtydnC7KS6fQvew4D",
    J:"https://drive.google.com/uc?export=download&id=194ZXxUJISwq5vkB94SZ_gJ_annsgVxy3",
    K:"https://drive.google.com/uc?export=download&id=12z_yfJUmhkd5LN1poMN2dNgXO1yyCSEA",
    L:"https://drive.google.com/uc?export=download&id=1HHPYFY4p-Z__6SZKEKgSOCBug4gsIGC1",
    M:"https://drive.google.com/uc?export=download&id=1zuOsAkuCo4bRV9LGl-ElNNjA2y5bTJa7",
    N:"https://drive.google.com/uc?export=download&id=1PiG51Z1neVqxVGvWxotHwhUd3-Ljb5Jy",
    O:"https://drive.google.com/uc?export=download&id=11ymp4cEflp3FIzJN3XYdalDdv8lqJLkX",
    P:"https://drive.google.com/uc?export=download&id=1YiqPEjT5C4gY8M7B6w3ykf8r4GdQQeeH",
    Q:"https://drive.google.com/uc?export=download&id=1ZOGnULcvvf8aNTWeZdjCB93xmcFnZVPb",
    R:"https://drive.google.com/uc?export=download&id=1QleiMuwxKQnlF4vfciQFxpLwEq7oV4zO",
    S:"https://drive.google.com/uc?export=download&id=1XBvC4nse_amvfLiLBReiEpDHcAfJ7Z1T",
    T:"https://drive.google.com/uc?export=download&id=1lPK7U4XqhbCY2eV9eNnHKmWyWMGljm3k",
    U:"https://drive.google.com/uc?export=download&id=13_Z4QA5fP6KzU0myieJD1ZG2IMU_aU6i",
    V:"https://drive.google.com/uc?export=download&id=1EKd7dITWTuEwIlVOQ_dq1Fy3BIfVJ6zA",
    W:"https://drive.google.com/uc?export=download&id=1Bh8Wx6tXfbwA1_KW4tHaMKd3Vmc2MQ3y",
    X:"https://drive.google.com/uc?export=download&id=1NqCJc7LGjdnGMDPnkmHY3qZx-PphRuxw",
    Y:"https://drive.google.com/uc?export=download&id=1GKyvE5x-aR_mlwXLBwDGEpGowwjR_Nnd",
    Z:"https://drive.google.com/uc?export=download&id=1K4J-Lu0zWHjk6ciMVxw_JuPiOrIuXXmZ"
  };

  const grid = document.getElementById('grid');
  const np   = document.getElementById('np');
  const status = document.getElementById('status');
  const wordInput = document.getElementById('wordInput');
  const stopAllBtn = document.getElementById('stopAll');
  const playAZBtn = document.getElementById('playAZ');
  const playWordBtn = document.getElementById('playWord');

  const active = new Set();      // all live Audio() objects
  const playing = [];            // [{letter, started, audio}]
  let sequencing = false;

  // Build button grid
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(L => {
    const b = document.createElement('button');
    b.className = 'btn';
    b.textContent = L;
    b.addEventListener('click', () => clickLetter(L, b));
    grid.appendChild(b);
  });

  // ----- Audio helpers -----
  function makeDriveURL(letter){ return DRIVE[letter] + (DRIVE[letter].includes('?')?'&':'?') + 'v=' + Date.now(); }

  function spawnAudio(letter){
    // try Drive (with cache-bust). If it fails, try local `A.mp3`.
    const a = new Audio(makeDriveURL(letter));
    a.preload = 'none';
    return {
      audio: a,
      async ensurePlayable(){
        try { await a.play(); a.pause(); }  // quick probe
        catch {
          // retry once
          a.src = makeDriveURL(letter);
          try { await a.play(); a.pause(); }
          catch {
            // local fallback
            a.src = letter + '.mp3';
          }
        }
        return a;
      }
    };
  }

  function addNowPlaying(letter, audio){
    const item = { letter, started: new Date(), audio };
    playing.unshift(item);
    if (playing.length > 20) playing.pop();
    renderNowPlaying();
    audio.onended = () => { removePlaying(item); active.delete(audio); };
    return item;
  }

  function removePlaying(item){
    const i = playing.indexOf(item);
    if (i >= 0) { playing.splice(i, 1); renderNowPlaying(); }
    if (playing.length === 0) status.textContent = "Ready. Tap a letter to play.";
  }

  function renderNowPlaying(){
    np.innerHTML = "";
    for (const p of playing) {
      const li = document.createElement('li');
      li.className = 'np-chip';
      li.innerHTML = `<strong>${p.letter}</strong> <small>${new Date(p.started).toLocaleTimeString()}</small>`;
      np.appendChild(li);
    }
  }

  // ----- Interactions -----
  async function clickLetter(letter, btn){
    btn.classList.add('flash'); setTimeout(()=>btn.classList.remove('flash'), 220);

    const { audio } = await spawnAudio(letter).ensurePlayable();
    active.add(audio);
    addNowPlaying(letter, audio);

    try { await audio.play(); status.innerHTML = `<span class="ok">Playing ${letter}</span>`; }
    catch { status.innerHTML = `<span class="warn">Could not play ${letter}. Check Drive sharing.</span>`; }
  }

  // Stop All ‚Äî make sure we *truly* stop and unload on mobile/iOS
  stopAllBtn.addEventListener('click', () => {
    const list = Array.from(active);
    for (const a of list) {
      try { a.pause(); } catch(e){}
      try { a.currentTime = 0; } catch(e){}
      try { a.removeAttribute('src'); a.load(); } catch(e){} // unload
    }
    active.clear();
    playing.length = 0;
    renderNowPlaying();
    sequencing = false;
    status.textContent = "‚èπÔ∏è Stopped all.";
  });

  // A ‚Üí Z sequence (sequential)
  playAZBtn.addEventListener('click', async () => {
    if (sequencing) return;
    sequencing = true;
    status.textContent = "üîÅ Sequencing A ‚Üí Z‚Ä¶";
    for (const L of "ABCDEFGHIJKLMNOPQRSTUVWXYZ") {
      if (!sequencing) break;
      const { audio } = await spawnAudio(L).ensurePlayable();
      active.add(audio);
      addNowPlaying(L, audio);
      try { await audio.play(); } catch {}
      await new Promise(r => setTimeout(r, 140)); // small gap
    }
    if (sequencing) status.textContent = "‚úÖ Done A ‚Üí Z";
    sequencing = false;
  });

  // Write the Word ‚Äî play ALL letters at the same time (overlapping)
  playWordBtn.addEventListener('click', async () => {
    const raw = (wordInput.value || "").toUpperCase();
    const letters = [...raw].filter(c => /[A-Z]/.test(c));
    if (letters.length === 0) { status.innerHTML = `<span class="warn">Type A‚ÄìZ letters.</span>`; return; }

    status.textContent = `‚úçÔ∏è Playing word: ${raw}`;
    // Spawn all audios first so they start nearly together
    const audios = await Promise.all(letters.map(L => spawnAudio(L).ensurePlayable()));
    audios.forEach((audio, i) => {
      const L = letters[i];
      active.add(audio);
      addNowPlaying(L, audio);
      // slight 30ms stagger to ease decoding on mobile
      setTimeout(() => { try { audio.play(); } catch{} }, i * 30);
    });
  });

  // Optional keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    const L = e.key.toUpperCase();
    const i = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(L);
    if (i >= 0) grid.children[i].click();
  });
</script>
</body>
</html>
